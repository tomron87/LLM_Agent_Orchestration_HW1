<div dir="rtl">

# ğŸ“¦ ×”×ª×§× ×” ×•×‘×“×™×§×•×ª â€” HW1_ai_chat_bot

××¡××š ×–×” ××¡×‘×™×¨ **×©×œ×‘Ö¾××—×¨Ö¾×©×œ×‘** ××™×š ×œ×”×§×™× ×¡×‘×™×‘×”, ×œ×”×¨×™×¥ ×‘×“×™×§×•×ª (×›×•×œ×œ ×ª×•×¦××•×ª ×¦×¤×•×™×•×ª ×•×¤×ª×¨×•×Ÿ ×ª×§×œ×•×ª), ×œ×‘×¦×¢ ×‘×“×™×§×ª ××™× ×˜×’×¨×¦×™×” ×¢× LangChainâ†”ï¸Ollama, ×•×œ×”×¤×¢×™×œ ××ª ×”××¢×¨×›×ª (API + UI).

---

---

## ğŸ§­ ×œ×¤× ×™ ×©××ª×—×™×œ×™× â€” ×œ×•×•×“× ××™×§×•× ×ª×™×§×™×™×” × ×›×•×Ÿ
×›×œ ×”×¤×§×•×“×•×ª ×‘××“×¨×™×š ×–×” ×™×© ×œ×”×¨×™×¥ ××ª×•×š **×ª×™×§×™×™×ª ×”×©×•×¨×© ×©×œ ×”×¤×¨×•×™×§×˜**:
`HW1_ai_chat_bot/`

×™×© ×œ×”×¢×ª×™×§ ××ª ×”×¤×§×•×“×•×ª ×•×œ×”×¨×™×¥ ××•×ª×Ÿ ×‘Ö¾**terminal** ×›××©×¨ ××ª× × ××¦××™× ×‘×ª×™×§×™×™×” ×–×•.
× ×™×ª×Ÿ ×œ×•×•×“× ×–××ª ×‘×××¦×¢×•×ª ×”×¤×§×•×“×”:
```
bash
pwd   # macOS/Linux
# ××•
cd    # Windows
```
×”×¤×œ×˜ ×¦×¨×™×š ×œ×”×¡×ª×™×™× ×‘:
.../HW1_ai_chat_bot

---

## âœ… ×“×¨×™×©×•×ª ××•×§×“××•×ª

1. **××¢×¨×›×ª ×”×¤×¢×œ×”**: macOS / Linux / Windows 10+  
2. **Python**: ×’×¨×¡×” 3.10 ×•××¢×œ×” (××•××œ×¥ 3.10.x).
3. **Ollama**: ××•×ª×§×Ÿ ×•× ×’×™×© ×‘Ö¾PATH.  
   - ×”×•×¨×“×” ×•×”×ª×§× ×”: <https://ollama.com>  
   - ×”×¤×¢×œ×”: `ollama serve`  
   - ××©×™×›×ª ××•×“×œ ×œ×“×•×’××”: `ollama pull phi` ××• `ollama pull mistral`
4. **Git** (××•××œ×¥): ×œ× ×™×”×•×œ ×§×•×“ ×•×’×¨×¡××•×ª.
5. **×¤×•×¨×˜** ×¤× ×•×™ ×œÖ¾Ollama (×‘×¨×™×¨×ª ××—×“×œ: `127.0.0.1:11434`).

> **×˜×™×¤**: ×× ××ª× ×‘×¡×‘×™×‘×ª Apple Silicon, ×•×“××• ×©Ö¾xcode-tools/Command Line Tools ××•×ª×§× ×™× (`xcode-select --install`).

---

## ğŸ§° ×”×•×¨××•×ª ×”×ª×§× ×”

### 1) ×™×¦×™×¨×ª ×¡×‘×™×‘×” ×•×™×¨×˜×•××œ×™×ª ×•×”×¤×¢×œ×ª×”
```
bash
# ×‘××•×ª×” ×¡×¤×¨×™×™×ª ×¤×¨×•×™×§×˜ (×©×•×¨×© ×”×¨×™×¤×•)
python -m venv .venv
# macOS/Linux
source .venv/bin/activate
# Windows (PowerShell)
# .venv\Scripts\Activate.ps1
```

### 2) ×”×ª×§× ×ª ×—×‘×™×œ×•×ª
```
pip install --upgrade pip
pip install -r requirements.txt
```

### 3) ×”×’×“×¨×ª ×§×•×‘×¥ .env
×¦×¨×• `.env` (××• ×”×¢×ª×™×§×• ×Ö¾`.env.example`) ×•×”×’×“×™×¨×•:
```
APP_API_KEY=my-local-token-123       # ×—×•×‘×” â€“ ××¤×ª×— ×’×™×©×” ××©×œ×›× (×ª×•×× ×œ××” ×©× ×©×œ×— ×‘×‘×§×©×”)
OLLAMA_HOST=http://127.0.0.1:11434   # ×—×•×‘×” â€“ ×›×ª×•×‘×ª ×©×¨×ª Ollama, ×œ×¨×•×‘ ×œ× ××©× ×™×
OLLAMA_MODEL=phi                     # ×—×•×‘×” â€“ ×©× ×”××•×“×œ ×©××•×ª×§×Ÿ ×‘-Ollama (phi/mistral)
API_URL=http://127.0.0.1:8000/api/chat   # ×—×•×‘×” ×œ×§×œ×™×™× ×˜ â€“ ×”×›×ª×•×‘×ª ×©×œ FastAPI ×©×œ×›× (×›×•×œ×œ /api/chat)

```
> **×—×©×•×‘**: ××œ ×ª×©××™×¨×• `APP_API_KEY=change-me`. ×©×™××• ×¢×¨×š ×××™×ª×™ ×›×œ×©×”×•.
---

## ğŸ§ª ×‘×“×™×§×•×ª â€” ×¡×“×¨ ×¨×™×¦×” ××•××œ×¥

×”×¤×¨×•×™×§×˜ ×›×•×œ×œ ×©× ×™ ×¡×•×’×™ ×‘×“×™×§×•×ª:
- **Unit** â€“ ×¨×¦×•×ª ×œ×œ× ×ª×œ×•×ª ×‘×©×¨×ª ×—×™×¦×•× ×™ (Ollama ×××•×§Ö¾/××–×•×™×£).
- **Integration** â€“ ×¨×¦×•×ª ××•×œ ×©×¨×ª Ollama ×××™×ª×™ (××•×¤×¦×™×•× ×œ×™).

×‘× ×•×¡×£ ×™×© **Preflight** (×‘×“×™×§×ª ×ª× ××™ ×¡×£) ×•Ö¾**×‘×“×™×§×ª LangChain** ××•×¤×¦×™×•× ×œ×™×ª.

> **×§×‘×¦×™ ×ª×¦×•×¨×”**:  
> - `pytest.ini` â€” ××’×“×™×¨ ×¡×™××•×Ÿ `@pytest.mark.integration` ×•××¡×œ×•×œ×™ ×‘×“×™×§×•×ª.  
> - `tests/conftest.py` â€” ×™×•×¦×¨ ×¤×œ×˜ ×§×¨×™×: ×©× ×§×•×‘×¥ â†’ ×©× ×‘×“×™×§×” â†’ `PASSED/FAILED` â†’ `EXPECTED` (+ `ACTUAL` ×‘××§×¨×” ×›×©×œ).

### 0) Preflight (×—×•×‘×” ×œ×¤× ×™ ×”×›×•×œ)
```
python ./scripts/preflight.py
```
×§×¨×™×˜×¨×™×•× ×™× ×œ×”×¦×œ×—×”:
- ××™×Ÿ ×©×•×¨×•×ª `[FAIL]` ×‘×¤×œ×˜.
- `APP_API_KEY` ××™× ×• placeholder.
- `OLLAMA_HOST` × ×¨××” URL ×—×•×§×™.
- (××•×¤×¦×™×•× ×œ×™) â€œOllama reachable â€¦â€ â€” ×ª×§×™×Ÿ ×× ×”×©×¨×ª ×¨×¥.
- **(×œÖ¾UI)** ××•×’×“×¨ `API_URL` ×‘×§×•×‘×¥ `.env` â€” ××—×¨×ª ×”Ö¾`streamlit_app.py` ×™×¤×¡×™×§ ×¢× ×”×•×“×¢×ª ×©×’×™××” ××ª××™××”.


×× ×›×©×œ: ×œ×ª×§×Ÿ ×œ×¤×™ ×”×”× ×—×™×•×ª ×©××•×“×¤×¡×•×ª (Hints) ×•×œ×¨×•×¥ ×©×•×‘.

### 1) Unit Tests â€” ×œ×œ× ×ª×œ×•×ª ×—×™×¦×•× ×™×ª
```
pytest -m "not integration" -q
```

> ×”×¤×œ×˜ ××¦×™×’ ×œ×›×œ ×§×•×‘×¥ ××ª ×”×¡×˜×˜×•×¡, ×œ×›×œ ×‘×“×™×§×” `PASSED/FAILED`, ×•××ª×—×ª:  
> `EXPECTED: â€¦` (×ª××™×“) ×•Ö¾`ACTUAL: â€¦` (×¨×§ ×‘×›×©×œ).  
> ×‘×¡×•×£ ×›×œ ×§×•×‘×¥: `>>> FILE STATUS: ALL PASSED` ×× ×›×œ ×”×‘×“×™×§×•×ª ×¢×‘×¨×•.

**×¤×™×¨×•×˜ ×‘×“×™×§×•×ª (Unit):**

×”×˜×‘×œ×” ×”×‘××” ××¤×¨×˜×ª ××ª ×›×œ ×‘×“×™×§×•×ª ×”×™×—×™×“×” ×‘×¤×¨×•×™×§×˜, ×œ×¤×™ ×§×•×‘×¥, ××˜×¨×ª ×›×œ ×‘×“×™×§×”, ×”×ª×•×¦××” ×”×¦×¤×•×™×” ×•××” ×œ×‘×“×•×§ ×‘××§×¨×” ×©×œ ×›×©×œ.

| ×§×•×‘×¥                                  | ××” ×”×‘×“×™×§×” ×‘×•×“×§×ª | ×ª×•×¦××•×ª ×¦×¤×•×™×•×ª | ×× × ×›×©×œ â€“ ××” ×œ×‘×“×•×§ / ××” ×œ×ª×§×Ÿ |
|---------------------------------------|---|---|---|
| `tests/test_auth_api.py`              | `test_missing_token_returns_401` â€” ×‘×§×©×ª `/api/chat` ×‘×œ×™ ×›×•×ª×¨×ª Authorization | ×¡×˜×˜×•×¡ `401` ×•×˜×§×¡×˜ ×©××›×™×œ â€œMissing bearer tokenâ€ | ×”×× ×”×›×•×ª×¨×ª ××›×Ÿ ×œ× × ×©×œ×—×”? ××™××•×© `require_api_key` ××—×–×™×¨ 401 ×•×©×¨×©×•×¨ ×”×•×“×¢×” × ×›×•× ×”; `APP_API_KEY` ×œ× ×××•×¨ ×œ×”×©×¤×™×¢ ×›××Ÿ |
|  `tests/test_auth_api.py`             | `test_invalid_token_returns_401` â€” ×›×•×ª×¨×ª ×¢× ×˜×•×§×Ÿ ×©×’×•×™ | ×¡×˜×˜×•×¡ `401` ×•×˜×§×¡×˜ ×©××›×™×œ â€œInvalid API keyâ€ | ×‘×“×§×• ×©×”×˜×•×§×Ÿ ×©×•× ×” ××”Ö¾`.env`; ×œ×•×’×™×§×ª ×”×”×©×•×•××” ×‘Ö¾`require_api_key`; ×œ× â€œ×œ×‘×œ×•×¢â€ ×©×’×™××•×ª |
| `tests/test_auth_api.py`              | `test_auth_wrong_scheme_returns_401` â€” ×©×™××•×© ×‘×¡×›×™××” ×œ× × ×›×•× ×” (`Token` ×‘××§×•× `Bearer`) | ×¡×˜×˜×•×¡ `401` | ×‘×“×§×• ×‘Ö¾`require_api_key` ×©××•×•×“××™× ×¡×›×™××ª `Bearer` (case-sensitive/insensitive ×‘×”×ª×× ×œ××“×™× ×™×•×ª) |
| `tests/test_auth_api.py`              | `test_auth_empty_bearer_returns_401` â€” ×¡×›×™××” × ×›×•× ×” ××‘×œ ×¢×¨×š ×¨×™×§ | ×¡×˜×˜×•×¡ `401` | ××™××•×ª ×©×œ× ××ª×§×‘×œ ×¢×¨×š ×¨×™×§; ×¤×¢× ×•×— ×”×›×•×ª×¨×ª; ×”×—×–×¨×ª ×”×•×“×¢×” ××ª××™××” |
| `tests/test_auth_api.py`              | `test_auth_lowercase_bearer_policy` â€” ×‘×“×™×§×ª ××“×™× ×™×•×ª lowercase/uppercase | ×× ××•×’×“×¨ ×›Ö¾case-insensitive â†’ `200`; ××—×¨×ª `401` | ×”×‘×”×™×¨×• ××ª ×”××“×™× ×™×•×ª ×‘×§×•×“/××¡××š; ×× ×¨×•×¦×™× ×œ×¢×‘×•×¨ ×‘×“×™×§×” ×–×• ×›Ö¾200, ×”×©×•×• ×¡×›×™××” ×ª×•×š ×”×•×¨×“×ª ×¨×™×©×™×•×ª |
| `tests/test_chat_validation_api.py`   | `test_chat_empty_messages_returns_422` â€” `messages` ×”×•× `[]` | ×¡×˜×˜×•×¡ `400/422` | ×”×’×‘×œ×•×ª ×¡×›×™××”: `messages` ×œ× ×¨×™×§; ×•×œ×™×“×¦×™×•×ª Pydantic ×‘Ö¾`ChatRequest` |
| `tests/test_chat_validation_api.py`   | `test_chat_missing_messages_key_returns_422` â€” ×—×¡×¨ ××¤×ª×— `messages` | ×¡×˜×˜×•×¡ `400/422` | ×©×“×” ×—×•×‘×” ×‘×¡×›×™××”; ×©××•×ª ×©×“×•×ª ×ª×•×××™×; ×©×™××•×© × ×›×•×Ÿ ×‘Ö¾`Field(...)` |
| `tests/test_chat_validation_api.py`   | `test_chat_message_missing_fields_returns_422` â€” ××™×‘×¨ ×‘Ö¾`messages` ×œ×œ× `content` ×ª×§×™×Ÿ | ×¡×˜×˜×•×¡ `400/422` | `ChatMessage.content` ×¢× `min_length=1`; ×‘×“×§×• ×©×œ× ××ª×§×‘×œ `""` |
| `tests/test_chat_validation_api.py`   | `test_chat_model_wrong_type_returns_422` â€” `model` ×œ× ××¡×•×’ ××—×¨×•×–×ª | ×¡×˜×˜×•×¡ `400/422` | ×˜×™×¤×•×¡×™ ×©×“×•×ª ×‘×¡×›×™××”; ×× ×”×©×“×” ××•×¤×¦×™×•× ×œ×™ â€” ×‘×“×§×• ×©×”×•× ××—×¨×•×–×ª ×›×©×œ××¡×¤×§×™× ×¢×¨×š |
| `tests/test_chat_validation_api.py`   | `test_chat_temperature_out_of_range_returns_422` â€” ×˜××¤×¨×˜×•×¨×” ××—×•×¥ ×œ×˜×•×•×— [0,1] | ×¡×˜×˜×•×¡ `400/422` | ×”×•×¡×™×¤×• ×©×“×” `temperature` ×œ×¡×›×™××” ×¢× ××’×‘×œ×•×ª; ××• ×¢×“×›× ×• ××ª ×”×˜×¡×˜ ×× ××™×Ÿ ×ª××™×›×” |
| `tests/test_chat_happy_errors_api.py` | `test_valid_token_with_mock` â€” Happy path: ××•×§××™× ×’ ×©×œ `ollama_client.has_model=True` ×•Ö¾`chat="MOCK-ANSWER"` | ×¡×˜×˜×•×¡ `200` ×•×’×•×£ `{"answer":"MOCK-ANSWER"}` | ×•×“××• ×©×××•×§ ×’× `has_model` ×œÖ¾`True` (×›×“×™ ×œ× ×œ×™×¤×•×œ ×œÖ¾`notice`), ×•×©×”××•×§ ×©×œ `chat` ××•×—×–×¨; ×‘×“×§×• ×©Ö¾endpoint ××—×–×™×¨ ××ª ×”Ö¾answer |
| `tests/test_chat_happy_errors_api.py` | `test_chat_when_client_raises_returns_5xx` â€” ××•×§××™× ×’ ×©×œ ×—×¨×™×’×” ×Ö¾`ollama_client.chat` | ×¡×˜×˜×•×¡ `500/502` ×•×’×•×£ ×¢× `detail`/`error` | ×××§×• ×’× `has_model=True` ×›×“×™ ×œ×”×’×™×¢ ×œ×¢× ×£ ×©×§×•×¨× ×œÖ¾`chat`; ×‘Ö¾endpoint ×œ×ª×¤×•×¡ ×—×¨×™×’×•×ª ×•×œ××¤×•×ª ×œÖ¾`HTTPException(5xx)` |
| `tests/test_chat_happy_errors_api.py` | `test_chat_endpoint_handles_missing_model` â€” ××•×“×œ ×œ× ×§×™×™× (`has_model=False`) | ×¡×˜×˜×•×¡ `200` ×¢× ×©×“×” `notice` ×™×“×™×“×•×ª×™ (â€œ×œ× ××•×ª×§×Ÿâ€¦â€) ×•Ö¾`answer` ×¨×™×§ | ×©×”Ö¾service/endpoint ××—×–×™×¨ `notice` ×•×œ× ×©×’×™××”; × ×™×¡×•×— ×”×”×•×“×¢×”; ××œ ×ª× ×¡×” ×œ×§×¨×•× ×œÖ¾`chat` ×›×©××™×Ÿ ××•×“×œ |
| `tests/test_health_api.py`            | `test_health_endpoint` â€” `/api/health` ×‘×¡×™×¡×™ | ×¡×˜×˜×•×¡ `200` ×•Ö¾JSON ×¢× ××¤×ª×—×•×ª `status`, `ollama` (×•××¤×©×¨ `default_model`) | ×”×¤×•× ×§×¦×™×” ××—×–×™×¨×” ××‘× ×” ×¢×§×‘×™ ×’× ×›×©×”×©×¨×ª ×–××™×Ÿ/×œ× ×–××™×Ÿ; ××™×Ÿ ×ª×œ×•×ª ×‘Ö¾Ollama ×œ×¡×˜×˜×•×¡ 200 ×‘×¡×™×¡×™ |
| `tests/test_health_api.py`            | `test_health_when_ping_fails_returns_structured_json` â€” `ping()` × ×›×©×œ | ×¡×˜×˜×•×¡ `200` (××• `503` ×œ×¤×™ ××“×™× ×™×•×ª) ×¢× JSON ×¢×§×‘×™ | ×©××¨×• ×¢×œ ×’×•×£ ×¢×§×‘×™ (××¤×ª×—×•×ª ×§×‘×•×¢×™×/×”×•×“×¢×”) ×’× ×‘×›×©×œ; ×× ×‘×—×¨×ª× 503 â€” ×¢×“×›× ×• ×ª×™×¢×•×“/×‘×“×™×§×” |
| `tests/test_config_settings.py`       | `test_settings_defaults_when_env_missing` â€” ×“×™×¤×•×œ×˜×™× ×›×©××™×Ÿ ENV | ×˜×™×¤×•×¡×™×/×“×™×¤×•×œ×˜×™× ×ª×§×™× ×™×: API key ××—×¨×•×–×ª, host ××ª×—×™×œ `http`, model ××—×¨×•×–×ª | `config.py` ×˜×•×¢×Ÿ dotenv; ×¢×¨×›×™ ×“×™×¤×•×œ×˜ ×ª×•×××™× ×œ××¡××š; ×œ×œ× ×§×¨×™×¡×” ×›×©×—×¡×¨ `.env` |
| `tests/test_config_settings.py`       | `test_settings_env_override` â€” ×¢×¨×›×™× ××”Ö¾ENV ×¢×•×§×¤×™× ×“×™×¤×•×œ×˜ | ×”×¢×¨×›×™× ×©×•× ×• ×œ×¢×¨×›×™ ×”×‘×“×™×§×” (×œ××©×œ `XYZ`, `http://x:1234`, `mistral`) | ×©×™××•×© ×‘Ö¾`os.getenv`/×˜×¢×™× ×ª dotenv ×‘×–××Ÿ; ××¤×©×¨×•×ª reload ×‘Ö¾fixture ×× ×¦×¨×™×š |
| `tests/test_ollama_client_unit.py`    | `test_ollama_client_end_to_end_unit` â€” ×™×—×™×“×” ×××•×§Ö¾×ª: `ping()` ×”×¦×œ×—×”/×›×©×œ, `chat()` URL/payload, 5xx â†’ raise | `ping` ××—×–×™×¨ `True/False` ×‘×”×ª×× ×œ××•×§; `chat` ××—×–×™×¨ `"OK"` ××ª×•×š `{"message":{"content":"OK"}}`; 5xx â†’ ×—×¨×™×’×” | ×•×“××• `requests.get/post` ×××•×§×™×; URL × ×‘× ×” ×Ö¾`OLLAMA_HOST` ×•××¡×ª×™×™× `/api/chat`; payload ×›×•×œ×œ `model/messages/stream/options.temperature` |
| `tests/test_ollama_client_unit.py`    | `test_has_model_handles_missing_models_key` â€” `/api/tags` ×—×¡×¨ `models` | ×”×¤×•× ×§×¦×™×” ××—×–×™×¨×” `False` ×œ×œ× ×—×¨×™×’×” | ×˜×™×¤×•×œ ×—×¡×™×Ÿ ×›×©××™×Ÿ ××¤×ª×—; ×”×—×–×¨×ª `False` ×›×‘×¨×™×¨×ª ××—×“×œ |
| `tests/test_ollama_client_unit.py`    | `test_chat_timeout_raises_runtimeerror` â€” ×–××ŸÖ¾×§×¦×•×‘/×—×™×‘×•×¨ × ×›×©×œ | ×”×¢×œ××ª `RuntimeError` (××• ×—×¨×™×’×” ××•×¡×›××ª) | ×‘Ö¾`chat()` ×œ×ª×¤×•×¡ `requests.Timeout/ConnectionError` ×•×œ×”×¢×œ×•×ª `RuntimeError` ××—×™×“; ×¢×“×›× ×• ×”×˜×¡×˜ ×× ×©× ×”×—×¨×™×’×” ×©×•× ×” |

**×”×¢×¨×•×ª ×›×œ×œ×™×•×ª:**
- ×›×œ ×”×‘×“×™×§×•×ª ×”×Ÿ **×‘×“×™×§×•×ª ×™×—×™×“×” (Unit)** ×××™×ª×™×•×ª â€“ ××™×Ÿ ×ª×œ×•×ª ×‘×©×¨×ª Ollama ×××™×ª×™; ×”×‘×“×™×§×•×ª ××©×ª××©×•×ª ×‘Ö¾`monkeypatch` ×›×“×™ ×œ××§×“ ××ª ×”×§×¨×™××•×ª.
- ×× ××ª×§×‘×œ×ª ×ª×•×¦××” ××¤×ª×™×¢×” (×œ××©×œ 200 ×¢× `notice` ×‘××§×•× 5xx), ×•×“××• ×©××•××§ ×’× `has_model` ×œÖ¾`True`.
- ×× ××—×ª ××‘×“×™×§×•×ª ×”×•×œ×™×“×¦×™×” × ×›×©×œ×ª (422/400), ×‘×“×§×• ××ª ×¡×›×™××ª ×”Ö¾Pydantic ×‘×§×•×‘×¥ `chat.py`.

---
### 2) Integration Tests â€” ××•×œ ×©×¨×ª Ollama ×××™×ª×™ (××•×¤×¦×™×•× ×œ×™)
×”×¨×™×¦×• ×‘×˜×¨××™× ×œ ××—×¨:  
```bash
ollama serve
```
``` 
bash
ollama pull <MODEL>   # ×× ×”××•×“×œ ×œ× ××•×ª×§×Ÿ
```
×•××–:  
```
pytest -m integration -q
```
**×¤×™×¨×•×˜ ×‘×“×™×§×•×ª (Integration):**

×”×‘×“×™×§×•×ª ×‘×§×•×‘×¥ ×–×” ×”×Ÿ **×‘×“×™×§×•×ª ××™× ×˜×’×¨×¦×™×” ×××™×ª×™×•×ª**, ×›×œ×•××¨ ×”×Ÿ ×ª×œ×•×™×•×ª ×‘×—×™×‘×•×¨ ×¤×¢×™×œ ×œ×©×¨×ª Ollama ××§×•××™.  
×”×Ÿ ×‘×•×“×§×•×ª ×–××™× ×•×ª ×©×œ ×”×©×¨×ª (`ping`) ×•×›×Ÿ ×§×™×•× ×©×œ ××•×“×œ×™× ××•×ª×§× ×™× ××§×•××™×ª ×œ×¤×™ ×”×”×’×“×¨×•×ª ×‘×§×•×‘×¥ `.env`.

| ×§×•×‘×¥ | ××” ×”×‘×“×™×§×” ×‘×•×“×§×ª | ×ª×•×¦××•×ª ×¦×¤×•×™×•×ª | ×× × ×›×©×œ â€“ ××” ×œ×‘×“×•×§ / ××” ×œ×ª×§×Ÿ |
|---|---|---|---|
| `tests/test_ollama_models_integration.py` | `test_ping_reachable` â€” ×‘×•×“×§×ª ×–××™× ×•×ª ×©×¨×ª Ollama ××§×•××™ ×‘×××¦×¢×•×ª `ping()` | ×”×¤×•× ×§×¦×™×” ××—×–×™×¨×” `True` ×× ×”×©×¨×ª ×¤×¢×™×œ, `False` ××—×¨×ª; ×× ×”×©×¨×ª ×œ× ×¤×¢×™×œ â€” ×”×‘×“×™×§×” ×ª×¡×•××Ÿ ×›Ö¾SKIPPED | ×•×“××• ×©×”×¤×§×•×“×” `ollama serve` ×¨×¦×” ×‘×¨×§×¢; ×× ××ª× ××¨×™×¦×™× ×¢×œ ××—×©×‘ ×—×“×© â€” ×•×“××• ×©×”×•×ª×§×Ÿ Ollama ×•×©×”×¤×•×¨×˜ (`127.0.0.1:11434`) ×¤×ª×•×— |
| `tests/test_ollama_models_integration.py` | `test_has_model_checks_local` â€” ×‘×•×“×§×ª ×× ×”××•×“×œ ×”×“×™×¤×•×œ×˜×™ ××”Ö¾`.env` ××•×ª×§×Ÿ ×‘×©×¨×ª ×”××§×•××™ | `has_model(default)` ××—×–×™×¨ `True` ×× ×”××•×“×œ ×§×™×™× ×•Ö¾`False` ×× ×œ×; ×‘×“×™×§×” ×œ××•×“×œ ×“××™×•× ×™ ×ª××™×“ ×ª×—×–×™×¨ `False` | ×•×“××• ×©×§×•×‘×¥ `.env` ××›×™×œ `OLLAMA_MODEL` ×ª×§×™×Ÿ (×œ××©×œ `phi` ××• `mistral`); ×”×¨×™×¦×• `ollama pull <model>` ×›×“×™ ×œ×•×•×“× ×©×”××•×“×œ ××•×ª×§×Ÿ; ×”×¤×¢×œ×ª ×”×©×¨×ª (`ollama serve`) × ×“×¨×©×ª ×œ×¤× ×™ ×”×¨×™×¦×” |

---

**×”×¢×¨×•×ª ×›×œ×œ×™×•×ª:**
- ×× Ollama ×œ× ×¤×¢×™×œ, ×”×˜×¡×˜×™× ×™×•×¤×™×¢×• ×›Ö¾`SKIPPED` ×•×œ× ×›Ö¾`FAILED`, ×›×“×™ ×œ×× ×•×¢ ×›×©×œ ×©×’×•×™.
- ××•××œ×¥ ×œ×•×•×“× ××¨××© ×©×”××•×“×œ×™× ×”× ×“×¨×©×™× ××•×ª×§× ×™× ×¢×:
  ```bash
  ollama pull phi
  ollama pull mistral
  ```
  
### 3) ×‘×“×™×§×ª ××™× ×˜×’×¨×¦×™×” LangChain â†”ï¸ Ollama
×§×•×‘×¥ ×¢×–×¨: `scripts/check_langchain.py`.  
×”×¨×¦×”:
```
python ./scripts/check_langchain.py
```
×ª×•×¦××” ×¦×¤×•×™×”: ×”×“×¤×¡×” ×©×œ ×ª×©×•×‘×” ×§×¦×¨×” ××”××•×“×œ. ×× × ×›×©×œ â€” ×ª×ª×§×‘×œ ×”×•×“×¢×” ×‘×¨×•×¨×” (×œ××©×œ ×¢×œ ×—×™×‘×•×¨/××•×“×œ).

---

# â–¶ï¸ ×”×¤×¢×œ×” ×•×”×¨×¦×” ×©×œ ×”××¢×¨×›×ª â€” HW1_ai_chat_bot

×”×¡×¢×™×£ ×”×‘× ××“×¨×™×š **×©×œ×‘Ö¾××—×¨Ö¾×©×œ×‘** ×›×™×¦×“ ×œ×”×¤×¢×™×œ ××ª ×”Ö¾API ×•××ª ×”Ö¾UI, ×•×›×™×¦×“ ×œ×××ª ×©×”×›×•×œ ×¢×•×‘×“ ×‘×¢×–×¨×ª ×‘×“×™×§×•×ª × ×§×•×“×•×ª ×§×¦×”.  
× × ×™×— ×©××ª× ×›×‘×¨ × ××¦××™× ×‘×ª×™×§×™×™×ª ×”×©×•×¨×© ×©×œ ×”×¤×¨×•×™×§×˜ (`HW1_ai_chat_bot`) ×•×”×¡×‘×™×‘×” ×”×•×•×™×¨×˜×•××œ×™×ª ×¤×¢×™×œ×”.

---

## 1) ×”×¤×¢×œ×ª ×©×¨×ª ×”â€‘API (FastAPI)

```
uvicorn app.main:app --reload
```
- ×‘××¡×•×£ ×××•×¨ ×œ×”×•×¤×™×¢: `Uvicorn running on http://127.0.0.1:8000`  
- ×”×©××™×¨×• ××ª ×”×—×œ×•×Ÿ ×”×–×” ×¤×ª×•×— ×‘×–××Ÿ ×”×¢×‘×•×“×”.

### ×‘×“×™×§×•×ª × ×§×•×“×•×ª ×§×¦×” (Endpoint Checks)

#### A. ×‘×¨×™××•×ª ××¢×¨×›×ª (×ª×•×× ×œ×˜×¡×˜×™× `test_health_api.py`)
```bash
curl http://127.0.0.1:8000/api/health
```
**×¦×¤×™:** JSON ×¢× ×”××¤×ª×—×•×ª: `status`, `ollama`, `default_model`  
×“×•×’××”:
```json
{"status":"ok","ollama":true,"default_model":"phi"}
```

#### B. ×§×¨×™××ª ×¦'××˜ ×‘×¡×™×¡×™×ª (×ª×•×× ×œ×˜×¡×˜×™× `test_auth_api.py` + `test_chat_*`)
> ×”×—×œ×™×¤×• ××ª `YOUR_APP_API_KEY` ×‘×©×•×¨×” ×œ××˜×” ×œ×¢×¨×š ××ª×•×š ×§×•×‘×¥ `.env` (×”××©×ª× ×” `APP_API_KEY`).

```bash
curl -X POST "http://127.0.0.1:8000/api/chat"   -H "Content-Type: application/json"   -H "Authorization: Bearer YOUR_APP_API_KEY"   -d '{"messages":[{"role":"user","content":"×©×œ×•×"}], "stream":false}'
```
**×¦×¤×™:**  
- ×× ×”××•×“×œ ××•×ª×§×Ÿ ×‘Ö¾Ollama â†’ ×¡×˜×˜×•×¡ `200` ×¢× ××¤×ª×— `answer`.  
- ×× ×”××•×“×œ ×œ× ××•×ª×§×Ÿ â†’ `200` ×¢× ××¤×ª×— `notice` ×©××¡×‘×™×¨ ×›×™×¦×“ ×œ×”×ª×§×™×Ÿ (×ª×•×× ×œ×˜×¡×˜ `test_chat_endpoint_handles_missing_model`).  
- ×× ×”×›×•×ª×¨×ª ×—×¡×¨×”/×œ× ×ª×§×™× ×” â†’ `401` (×ª×•×× ×œ×˜×¡×˜×™× `test_auth_api.py`).  
- ×× ×’×•×£ ×”×‘×§×©×” ×œ× ×ª×§×™×Ÿ (×œ××©×œ `messages` ×¨×™×§) â†’ `400/422` (×ª×•×× ×œÖ¾`test_chat_validation_api.py`).

> **×˜×™×¤:** ×× ×§×™×‘×œ×ª× `401` â€“ ×•×“××• ×©×”×›×•×ª×¨×ª `Authorization` ×ª×§×™× ×” ×•×©Ö¾`APP_API_KEY` ×ª×•×× ×‘×“×™×•×§ ×œ×¢×¨×š ×‘Ö¾`.env`.

---

## 2) ×”×¤×¢×œ×ª ×××©×§ ××©×ª××© (Streamlit)

```bash
streamlit run ./ui/streamlit_app.py
```
- ×‘×¨×™×¨×ª ××—×“×œ: Streamlit ×™× ×¡×” ×œ×¤×ª×•×— ×“×¤×“×¤×Ÿ ××•×˜×•××˜×™×ª.  
- ×× ×”×•× **×œ× × ×¤×ª×— ××•×˜×•××˜×™×ª**, ×›× ×¡×• ×™×“× ×™×ª ×œ×›×ª×•×‘×ª:
  - `http://127.0.0.1:8501` ××• `http://localhost:8501`

### ××” ×—×©×•×‘ ×œ×”×’×“×™×¨ ×œ×¤× ×™ ×”×”×¤×¢×œ×”
×‘Ö¾`.env` ×¦×¨×™×š ×œ×”×™×•×ª:
```dotenv
API_URL=http://127.0.0.1:8000/api/chat
```
×–×”×• ×”Ö¾endpoint ×©×œ ×”Ö¾API ×©×”Ö¾UI ×¤×•× ×” ××œ×™×•. ×•×“××• ×’× ×©×©×¨×ª ×”Ö¾API (Uvicorn) ×¨×¥ ×‘××§×‘×™×œ.

### ×›×™×¦×“ ××××ª×™× ×©×”Ö¾UI ××ª×§×©×¨ ×œÖ¾API
- ×‘×©×“×” ×”×”×•×“×¢×” ×‘Ö¾UI ×›×ª×‘×•: â€œ×©×œ×•×â€ ×•×œ×—×¦×• Send/Submit.  
- **×¦×¤×™:** ×ª×©×•×‘×” ××”××•×“×œ (×× ××•×ª×§×Ÿ), ××• ×”×•×“×¢×ª `notice` ×× ×œ× ××•×ª×§×Ÿ.  
- ×× ××§×‘×œ×™× ×©×’×™××ª `401` â†’ ×¢×“×›× ×• `APP_API_KEY` ×•×‘×“×§×• ×©×”Ö¾UI ×©×•×œ×— Bearer ×ª×•××.  
- ×× ××™×Ÿ ×ª×§×©×•×¨×ª â†’ ×•×“××• ×©×”Ö¾`API_URL` ××›×•×•×Ÿ ×œÖ¾`http://127.0.0.1:8000/api/chat` ×•×©×©×¨×ª ×”Ö¾API ×¨×¥.

---
## ×”×¤×¢×œ×” ×‘×××¦×¢×•×ª Makefile
×”Ö¾Makefile ×¢×•×˜×£ ××ª ×©×œ×‘×™ ×”×”×¤×¢×œ×” ×œ×¤×™ ×”×¡×“×¨: **preflight â†’ install â†’ ollama â†’ api â†’ ui**.

| Target | ××” ×¢×•×©×” | ×”×¢×¨×•×ª ×©×™××•×© |
|---|---|---|
| `make help` | ×”×¦×’×ª ×¤×§×•×“×•×ª ×–××™× ×•×ª ×•×”×¡×‘×¨ ×¢×œ ×›×œ ××—×ª | ××“×¤×™×¡ ××ª ×¨×©×™××ª ×”×¤×§×•×“×•×ª ××”Ö¾Makefile |
| `make preflight` | ×‘×“×™×§×ª Python/×—×‘×™×œ×•×ª/Ollama/ENV | ××¨×™×¥ `scripts/preflight.py` |
| `make install` | ×”×ª×§× ×ª ×ª×œ×•×™×•×ª | ×§×•×¨× `requirements.txt` ×× ×§×™×™× |
| `make ollama` | ××•×•×“× ×©×©×¨×ª Ollama ×¨×¥ | ××¤×¢×™×œ `ollama serve` ×× × ×“×¨×©, ×‘×•×“×§ `/api/tags` |
| `make api` | ××¤×¢×™×œ FastAPI ×¢× Uvicorn | ×¤×¨××˜×¨×™×: `HOST`, `PORT` |
| `make ui` | ××¤×¢×™×œ Streamlit | ×¤×¨××˜×¨: `STREAMLIT_PORT` |
| `make test` | ××¨×™×¥ ×›×œ ×”×‘×“×™×§×•×ª | ××›×‘×“ `pytest.ini` |
| `make test-unit` | ×‘×“×™×§×•×ª ×™×—×™×“×” | ×©×§×•×œ ×œÖ¾`pytest -m "not integration"` |
| `make test-integration` | ××¨×™×¥ ×‘×“×™×§×•×ª ××™× ×˜×’×¨×¦×™×” | ×“×•×¨×© `@pytest.mark.integration` |
| `make all` | ×”×¤×¢×œ×” ××§×¦×” ×œ×§×¦×” | API ×‘×¨×§×¢, UI ×‘×§×“××” |
| `make clean` | × ×™×§×•×™ cache ×©×œ Python | ××•×¤×¦×™×•× ×œ×™ |

### ×”×¨×¦×ª ×‘×“×™×§×•×ª ×œ×¤×™ markers
×‘×¤×¨×•×™×§×˜ ×–×” ×§×™×™× ××¨×§×¨ ××—×“:
```ini
[pytest]
markers = integration: tests that require a running local Ollama server
```

---

## â“ ×ª×§×œ×•×ª × ×¤×•×¦×•×ª ×•×¤×ª×¨×•×Ÿ ××”×™×¨

| ×¡×™××¤×˜×•× | ×¡×™×‘×” × ×¤×•×¦×” | ×¤×ª×¨×•×Ÿ |
|---|---|---|
| 401 ×¢×œ `/api/chat` | `APP_API_KEY` placeholder / ×›×•×ª×¨×ª Authorization ×—×¡×¨×”/×œ× ×ª×§×™× ×” | ×¢×“×›×•×Ÿ `.env` (×¢×¨×š ×××™×ª×™ ×‘Ö¾`APP_API_KEY`); ×©×œ×™×—×ª `Authorization: Bearer <APP_API_KEY>` |
| 422 / 400 ×¢×œ `/api/chat` | ×¡×›×™××ª ×‘×§×©×” ×œ× ×ª×§×™× ×” | ×œ×•×•×“× `messages` ×¨×©×™××” ×œ× ×¨×™×§×”; ×œ×›×œ ×”×•×“×¢×” `role` ×•Ö¾`content` ×œ× ×¨×™×§×™× |
| 200 ×¢× `notice` ×‘××§×•× ×ª×©×•×‘×” | ××•×“×œ ×œ× ××•×ª×§×Ÿ ×‘Ö¾Ollama | ×œ×”×¨×™×¥ `ollama serve` ×•××– `ollama pull <model>` (×œ××©×œ `phi`/`mistral`) |
| Timeouts / Connection Errors | Ollama ×œ× ×¨×¥ / ×›×ª×•×‘×ª ×©×’×•×™×” | ×œ×”×¤×¢×™×œ `ollama serve`; ×œ×‘×“×•×§ `OLLAMA_HOST` ×‘Ö¾`.env`; ×œ×”×¨×™×¥ `python scripts/preflight.py` |
| Port already in use | ××•×¤×¢×œ ×©×¨×ª ××—×¨ ×¢×œ ××•×ª×• ×¤×•×¨×˜ | ×œ×¢×¦×•×¨ ×ª×”×œ×™×›×™× ×§×•×“××™× ××• ×œ×”×¨×™×¥ ×¢× ×¤×•×¨×˜ ××—×¨: `uvicorn app.main:app --reload --port 8001` |
| UI ×œ× × ×¤×ª×— ××•×˜×•××˜×™×ª | ×”×“×¤×“×¤×Ÿ ×œ× × ×¤×ª×— ××•×˜×•××˜×™×ª / ×—×•××ª ××© | ×œ×¤×ª×•×— ×™×“× ×™×ª: `http://127.0.0.1:8501`; ×œ×‘×“×•×§ ×©×—×•××ª ×”××© ×œ× ×—×•×¡××ª |
| PytestUnknownMarkWarning | `pytest` ×œ× ××›×™×¨ ××ª `integration` | ×•×“××• ×©×‘Ö¾`pytest.ini` ××•×’×“×¨: `markers =\n    integration: tests that require a running local Ollama server` |

---

## ğŸ“ ×”×¢×¨×•×ª ×¢×œ ×§×‘×¦×™ ×”×‘×“×™×§×•×ª (×§×™×©×•×¨ ×œ×”×™×’×™×•×Ÿ ×”×”×¤×¢×œ×”)

- **×‘×¨×™××•×ª ×”××¢×¨×›×ª** â€“ ×ª×•×× ×œÖ¾`tests/test_health_api.py` (×‘×•×“×§ JSON ×¢×§×‘×™ ×’× ×× `ping()` × ×›×©×œ).  
- **××™××•×ª ×’×™×©×” (401/200)** â€“ ×ª×•×× ×œÖ¾`tests/test_auth_api.py` (Bearer Token ×ª×§×™×Ÿ/×©×’×•×™/×—×¡×¨/×¡×›×™××” ×©×’×•×™×”).  
- **×•×œ×™×“×¦×™×™×ª ×’×•×£ ×”×‘×§×©×”** â€“ ×ª×•×× ×œÖ¾`tests/test_chat_validation_api.py` (×¨×™×§/×©×“×•×ª ×—×¡×¨×™×/×˜×™×¤×•×¡×™× ×œ× ×ª×§×™× ×™×).  
- **Happy path + ×—×¨×™×’×•×ª** â€“ ×ª×•×× ×œÖ¾`tests/test_chat_happy_errors_api.py` (××•×§××™× ×’ ×œ×ª×©×•×‘×”, 5xx ×¢×œ ×—×¨×™×’×•×ª, notice).  
- **×©×›×‘×ª Ollama (×™×—×™×“×” ×××•×§Ö¾×ª)** â€“ `tests/test_ollama_client_unit.py` (URL/payload/timeout/×©×’×™××•×ª) â€“ **×œ×** ×“×•×¨×© ×©×¨×ª ×××™×ª×™.  
- **×‘×“×™×§×•×ª ××™× ×˜×’×¨×¦×™×” ××•×œ Ollama** â€“ `tests/test_ollama_models_integration.py` (×“×•×¨×© `ollama serve`; SKIPPED ×›×©×œ× ×¨×¥).

</div>
